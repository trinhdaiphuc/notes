"use strict";(self.webpackChunkmy_notes=self.webpackChunkmy_notes||[]).push([[9519],{7682:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>r,contentTitle:()=>c,default:()=>l,frontMatter:()=>s,metadata:()=>o,toc:()=>h});var n=a(5893),i=a(1151);const s={},c="Cache me if you can: A Look at Common Caching Strategies, and how CQRS can Replace the Need in the First Place",o={id:"Technical stack/cached-me-if-you-can",title:"Cache me if you can: A Look at Common Caching Strategies, and how CQRS can Replace the Need in the First Place",description:"Source//medium.com/ssense-tech/cache-me-if-you-can-a-look-at-common-caching-strategies-and-how-cqrs-can-replace-the-need-in-the-65ec2b76e9e",source:"@site/docs/Technical stack/cached-me-if-you-can.md",sourceDirName:"Technical stack",slug:"/Technical stack/cached-me-if-you-can",permalink:"/docs/Technical stack/cached-me-if-you-can",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Technical stack/cached-me-if-you-can.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"6 strategic ways to level up your CI/CD pipeline",permalink:"/docs/Technical stack/ways-level-up-ci-cd-pipeline"},next:{title:"WebRTC",permalink:"/docs/Technical stack/webrtc"}},r={},h=[{value:"It\u2019s (Almost) all About Latency",id:"its-almost-all-about-latency",level:2},{value:"When is Caching Beneficial?",id:"when-is-caching-beneficial",level:2},{value:"Common Caching Strategies",id:"common-caching-strategies",level:2},{value:"Read-Through Caching",id:"read-through-caching",level:3},{value:"Write-Through Caching",id:"write-through-caching",level:3},{value:"Write-Behind Caching",id:"write-behind-caching",level:3},{value:"Why Adding a Cache is a Non-Trivial Task",id:"why-adding-a-cache-is-a-non-trivial-task",level:3},{value:"Stale Data",id:"stale-data",level:4},{value:"Cache Stampede",id:"cache-stampede",level:4},{value:"Why CQRS can be your Cache",id:"why-cqrs-can-be-your-cache",level:3},{value:"Conclusion",id:"conclusion",level:3}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",ul:"ul",...(0,i.a)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.h1,{id:"cache-me-if-you-can-a-look-at-common-caching-strategies-and-how-cqrs-can-replace-the-need-in-the-first-place",children:"Cache me if you can: A Look at Common Caching Strategies, and how CQRS can Replace the Need in the First Place"}),"\n",(0,n.jsxs)(t.blockquote,{children:["\n",(0,n.jsxs)(t.p,{children:["Source: ",(0,n.jsx)(t.a,{href:"https://medium.com/ssense-tech/cache-me-if-you-can-a-look-at-common-caching-strategies-and-how-cqrs-can-replace-the-need-in-the-65ec2b76e9e",children:"https://medium.com/ssense-tech/cache-me-if-you-can-a-look-at-common-caching-strategies-and-how-cqrs-can-replace-the-need-in-the-65ec2b76e9e"})]}),"\n"]}),"\n",(0,n.jsx)(t.h2,{id:"its-almost-all-about-latency",children:"It\u2019s (Almost) all About Latency"}),"\n",(0,n.jsx)(t.p,{children:"Low latency requests are a standard non-functional requirement. The way reduce latency is adding the cached - a copy of data - that can be retrieved significantly faster than if we attempted to do the same from the origin."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Figure 1. The cache holds a copy of the data where the access is much faster than the origin.",src:a(6751).Z+"",width:"720",height:"437"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"The cache holds a copy of the data where the access is much faster than the origin."})}),"\n",(0,n.jsxs)(t.p,{children:["Caching appear in the network infrastructure used to serve the web pages (Ex: ",(0,n.jsx)(t.a,{href:"https://www.cloudflare.com/en-gb/learning/cdn/cdn-load-balance-reliability/",children:"CDN reliability and redundancy"}),")"]}),"\n",(0,n.jsx)(t.h2,{id:"when-is-caching-beneficial",children:"When is Caching Beneficial?"}),"\n",(0,n.jsx)(t.p,{children:"Before deciding to add a cache make sure to actually consider if your application needs one. Customer-facing applications are usually more sensitive than server-to-server needs."}),"\n",(0,n.jsx)(t.p,{children:"Traditionally, the need for caching your response being the result of a query that executes multiple joins behind the scenes. It takes time before delivering the response back to the client. Having a quickly accessible pre-joined result is nesscessary for high load system."}),"\n",(0,n.jsx)(t.p,{children:"Before implementing a cache in the development of your application, you need analys that you do not need a cache or not. For example, if your application is not sending information back to someone who is browsing your e-commerce website, it may not matter if it takes 10 or 100 milliseconds to process your request."}),"\n",(0,n.jsx)(t.h2,{id:"common-caching-strategies",children:"Common Caching Strategies"}),"\n",(0,n.jsx)(t.h3,{id:"read-through-caching",children:"Read-Through Caching"}),"\n",(0,n.jsx)(t.p,{children:"In this approach, your application will first attempt to read from your cache. If the requested information is not found it will fetch from the original source, add that information to the cache, and then return to the client.."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Read-through cache",src:a(1930).Z+"",width:"822",height:"558"})}),"\n",(0,n.jsxs)(t.p,{children:["You don't need to cache all data to fit in the cache and you may have an ",(0,n.jsx)(t.a,{href:"https://redis.io/docs/manual/eviction/",children:"eviction strategy"})," to remove entries that are too old and possibly outdated, or are not as frequently accessed and can be removed in order to save space (LRU, LFU, etc.)."]}),"\n",(0,n.jsx)(t.h3,{id:"write-through-caching",children:"Write-Through Caching"}),"\n",(0,n.jsx)(t.p,{children:"Auto update cache when write to the origin."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Write-Through Caching",src:a(4859).Z+"",width:"809",height:"863"})}),"\n",(0,n.jsx)(t.p,{children:"This strategy will keep the cache in sync with the origin, and remove stale data, but comes with two additional costs:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Your cache needs to save the entire data set. If most of the data is never read, cache will unnecessarily host useless data."}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"Your writes will be slower and more complex as they need to write to both persistence solutions and potential failures of one of them ie. writing to the origin succeeds but writing to the cache fails."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"write-behind-caching",children:"Write-Behind Caching"}),"\n",(0,n.jsxs)(t.p,{children:["The final strategy write-behind flips the ",(0,n.jsx)(t.code,{children:"source of truth"})," (SOT) to the cache."]}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Write-Behind Caching",src:a(5586).Z+"",width:"799",height:"1006"})}),"\n",(0,n.jsx)(t.p,{children:"Similarly to the write-through, the cache must be able to hold the entire data set, but the SOT is temporarily the cache and eventually makes its way toward the origin. Because the information is first written to the cache, it is always up-to-date and retrieval will always return the information with low(er) latency."}),"\n",(0,n.jsx)(t.p,{children:"Unfortunately, there are two complexities with this solution:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"The cache must be resilient to make sure it does not lose any information prior to it making its way to the origin."}),"\n"]}),"\n",(0,n.jsxs)(t.li,{children:["\n",(0,n.jsx)(t.p,{children:"There is an additional sync process to be developed and maintained."}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"why-adding-a-cache-is-a-non-trivial-task",children:"Why Adding a Cache is a Non-Trivial Task"}),"\n",(0,n.jsx)(t.p,{children:"Adding cache simplify reduce read-through strategy. In reality, you will encounter several details that make even the most straightforward approach error-prone. Let\u2019s look at the often overlooked pitfalls."}),"\n",(0,n.jsx)(t.h4,{id:"stale-data",children:"Stale Data"}),"\n",(0,n.jsx)(t.p,{children:"For an application to use caching, it must already accept that it will serve potentially outdated information."}),"\n",(0,n.jsx)(t.p,{children:"The simplest approach is to set a time to live (TTL). After that time the data found in a cache is to be ignored or delete from cached. That\u2019s great but what value should you put it at? 5 seconds? 5 minutes?"}),"\n",(0,n.jsx)(t.p,{children:"If you set TTL value too big, the information in the origin may have changed and you\u2019ll be sending outdated information to clients. If you put it too small most number of requests can not get data from cached. In the end, your application context should dictate the TTL you select."}),"\n",(0,n.jsx)(t.h4,{id:"cache-stampede",children:"Cache Stampede"}),"\n",(0,n.jsx)(t.p,{children:"Imagine that when we try to get data from cached and not found it, we need to request the origin to get data. Nothing out of the ordinary, but there are hundred of requests arriving almost the same time (the cache data haven't updated yet). After that they trigger request to the origin and increase the database throughput."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"Cache Stampede",src:a(7274).Z+"",width:"720",height:"496"})}),"\n",(0,n.jsx)(t.p,{children:"So we can lock the access so only one request will actually trigger the access to the origin, to preemptively making sure an item is found in the cache prior to enabling any traffic to the origin."}),"\n",(0,n.jsx)(t.h3,{id:"why-cqrs-can-be-your-cache",children:"Why CQRS can be your Cache"}),"\n",(0,n.jsx)(t.p,{children:"Command Query Responsibility Segregation is a pattern that a query is an action that does not mutate the state while a command does. Additionally, although not mandatory, CQRS implementations leverage different persistence solutions  between the query and command sides."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"cqrs",src:a(8511).Z+"",width:"720",height:"288"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"A simple example of CQRS with two different persistence used for write and read operations."})}),"\n",(0,n.jsx)(t.p,{children:"One reason is that the writing side is where to ensure the business rules are respected. The read side, on the other hand, may just require a (subset) of the entity and no logic to guard changes."}),"\n",(0,n.jsx)(t.p,{children:"The write side will emit messages \u2014 events \u2014 representing the state changes that resulted from a command. You will use those messages to create and maintain the read side."}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.img,{alt:"aws cqrs",src:a(7600).Z+"",width:"720",height:"428"})}),"\n",(0,n.jsx)(t.p,{children:(0,n.jsx)(t.em,{children:"Sample implementation leveraging AWS services to stream events and build one or more read models."})}),"\n",(0,n.jsx)(t.p,{children:"Because the read side has no require to match the write side on the technology to use, you can select one that addresses the latency requirements."}),"\n",(0,n.jsx)(t.p,{children:"So let\u2019s recap the properties commonly found in a cache:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Cached data is eventually consistent with the origin"}),"\n",(0,n.jsx)(t.li,{children:"Provides a pre-computed result"}),"\n",(0,n.jsx)(t.li,{children:"Satisfies a read-only pattern with low(er) latency requirements"}),"\n"]}),"\n",(0,n.jsx)(t.p,{children:"With CQRS we end up with a solution that matches all the above, with a couple of advantages:"}),"\n",(0,n.jsxs)(t.ul,{children:["\n",(0,n.jsx)(t.li,{children:"Contrary to most cache implementations, CQRS is not an afterthought but rather planned from the beginning"}),"\n",(0,n.jsx)(t.li,{children:"The read side can be simple as there is no need for repositories or manipulating entities. Simple data transfer objects (DTOs) can be used to represent the data."}),"\n"]}),"\n",(0,n.jsx)(t.h3,{id:"conclusion",children:"Conclusion"}),"\n",(0,n.jsx)(t.p,{children:"Caching is a ubiquitous pattern used in application development. The typical cycle is to develop your application, deploy it, and after some time find out that you have to add a cache because your application can\u2019t cope with demand."}),"\n",(0,n.jsx)(t.p,{children:"On the surface, it may look like a trivial task, but managing TTLs and handling stampedes are two of the most overlooked complexities that you should factor in when deciding to add a cache."}),"\n",(0,n.jsx)(t.p,{children:"Alternatively, if you are already developing an event-drive application (EDA), a potential solution instead of adding a cache is to leverage a CQRS pattern as it will make use of the already existing event approach and infrastructure to deliver the desired outcome from the get-go."}),"\n",(0,n.jsx)(t.p,{children:"Finally, remember to challenge if your application really benefits from a specific low latency operation. Faster is often better but the cost to achieve it may be steep. No matter what solution you choose, make sure to distinguish between the desire to have caching and a truly advantageous use case where the effort required to implement caching has significant improvements on your application."})]})}function l(e={}){const{wrapper:t}={...(0,i.a)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},7600:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/aws-cqrs-6399d410b6de0591901373e92c2c3bea.png"},7274:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cache-stampede-e31afb2d5a32b71517dd28b1e846f422.png"},6751:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cached-pattern-232e4bfdda15f23d9ea243bc5d35bb8f.png"},8511:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/cqrs-d7569a5206964afe3db3dd36a139d757.png"},1930:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/read-through-caching-94efe0395c8b0726763e66b55254d74e.png"},5586:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/write-behind-caching-c73f8fc849c4d0a3d89cacbc497b5f4d.png"},4859:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/write-through-caching-90f46dc7836cb38772c2e4fec14d3871.png"},1151:(e,t,a)=>{a.d(t,{Z:()=>o,a:()=>c});var n=a(7294);const i={},s=n.createContext(i);function c(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),n.createElement(s.Provider,{value:t},e.children)}}}]);