"use strict";(self.webpackChunkmy_notes=self.webpackChunkmy_notes||[]).push([[8062],{780:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>c,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>h});var r=t(5893),i=t(1151);const o={},c="Use HTTP Client to enhance performance",s={id:"Programing language/Golang/http-client",title:"Use HTTP Client to enhance performance",description:"\u0110\u1ec3 t\u1ea1o m\u1ed9t request l\u1ea5y th\xf4ng tin t\u1eeb m\u1ed9t server ch\u1ee9ng ta hay s\u1eed d\u1ee5ng http.DefaultClient ho\u1eb7c &http.Client{} m\xe0",source:"@site/docs/Programing language/Golang/http-client.md",sourceDirName:"Programing language/Golang",slug:"/Programing language/Golang/http-client",permalink:"/docs/Programing language/Golang/http-client",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Programing language/Golang/http-client.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"GRPC load balancing in Kubernetes",permalink:"/docs/Programing language/Golang/grpc-load-balancing-in-kubernetes"},next:{title:"Tutorial Intro",permalink:"/docs/intro"}},l={},h=[{value:"Table of content:",id:"table-of-content",level:2},{value:"Default HTTP Client",id:"default-http-client",level:3},{value:"Default Transport",id:"default-transport",level:3},{value:"References",id:"references",level:2}];function a(n){const e={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"use-http-client-to-enhance-performance",children:"Use HTTP Client to enhance performance"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["\u0110\u1ec3 t\u1ea1o m\u1ed9t request l\u1ea5y th\xf4ng tin t\u1eeb m\u1ed9t server ch\u1ee9ng ta hay s\u1eed d\u1ee5ng ",(0,r.jsx)(e.code,{children:"http.DefaultClient"})," ho\u1eb7c ",(0,r.jsx)(e.code,{children:"&http.Client{}"})," m\xe0\r\nkh\xf4ng c\u1ea5u h\xecnh g\xec th\xeam. V\u1eady \u0111i\u1ec1u n\xe0y c\xf3 \u1ea3nh h\u01b0\u1edfng g\xec t\u1edbi hi\u1ec7u n\u0103ng c\u1ee7a \u1ee9ng d\u1ee5ng?"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"table-of-content",children:"Table of content:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"#default-http-client",children:"Default HTTP Client"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"#default-transport",children:"Default Transport"})}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"default-http-client",children:"Default HTTP Client"}),"\n",(0,r.jsxs)(e.p,{children:["Khi ta s\u1eed d\u1ee5ng ",(0,r.jsx)(e.code,{children:"http.DefaultClient"}),", ",(0,r.jsx)(e.code,{children:"&http.Client{}"}),", ",(0,r.jsx)(e.code,{children:"http.Get(url,...)"})," \u0111\u1ec3 t\u1ea1o m\u1ed9 http client th\xec th\u01b0 vi\u1ec7n s\u1ebd\r\nd\xf9ng c\xe1c c\u1ea7u h\xecnh m\u1eb7c \u0111\u1ecbnh c\u1ee7a th\u01b0 vi\u1ec7n. Trong package ",(0,r.jsx)(e.code,{children:"net/http"})," th\xec struct ",(0,r.jsx)(e.code,{children:"Client"})," \u0111\u01b0\u1ee3c m\xf4 t\u1ea3 nh\u01b0 sau."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"type Client struct {\r\n    // Transport specifies the mechanism by which individual\r\n    // HTTP requests are made.\r\n    // If nil, DefaultTransport is used.\r\n    Transport RoundTripper\r\n\r\n    // CheckRedirect specifies the policy for handling redirects.\r\n    // If CheckRedirect is not nil, the client calls it before\r\n    // following an HTTP redirect. The arguments req and via are\r\n    // the upcoming request and the requests made already, oldest\r\n    // first. If CheckRedirect returns an error, the Client's Get\r\n    // method returns both the previous Response (with its Body\r\n    // closed) and CheckRedirect's error (wrapped in a url.Error)\r\n    // instead of issuing the Request req.\r\n    // As a special case, if CheckRedirect returns ErrUseLastResponse,\r\n    // then the most recent response is returned with its body\r\n    // unclosed, along with a nil error.\r\n    //\r\n    // If CheckRedirect is nil, the Client uses its default policy,\r\n    // which is to stop after 10 consecutive requests.\r\n    CheckRedirect func(req *Request, via []*Request) error\r\n\r\n    // Jar specifies the cookie jar.\r\n    Jar CookieJar\r\n\r\n    // Timeout specifies a time limit for requests made by this\r\n    // Client. The timeout includes connection time, any\r\n    // redirects, and reading the response body. The timer remains\r\n    // running after Get, Head, Post, or Do return and will\r\n    // interrupt reading of the Response.Body.\r\n    //\r\n    // A Timeout of zero means no timeout.\r\n    //\r\n    // The Client cancels requests to the underlying Transport\r\n    // as if the Request's Context ended.\r\n    //\r\n    // For compatibility, the Client will also use the deprecated\r\n    // CancelRequest method on Transport if found. New\r\n    // RoundTripper implementations should use the Request's Context\r\n    // for cancellation instead of implementing CancelRequest.\r\n    Timeout time.Duration\r\n}\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Transport"})," l\xe0 th\xe0nh ph\u1ea7n ch\xednh qu\u1ea3n l\xfd connection pool. N\u1ebfu kh\xf4ng c\u1ea5u h\xecnh g\xec th\xec th\u01b0 vi\u1ec7n s\u1ebd l\u1ea5y ",(0,r.jsx)(e.code,{children:"DefaultTransport"})," ph\u1ea7n n\xe0y s\u1ebd n\xf3i r\xf5 h\u01a1n \u1edf ",(0,r.jsx)(e.a,{href:"#default-transport",children:"ph\u1ea7n sau"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"CheckRedirect"})," l\xe0 h\xe0m \u0111\u1ec3 qu\u1ea3n l\xfd c\xe1c y\xeau c\u1ea7u chuy\u1ec3n h\u01b0\u1edbng c\u1ee7a request khi g\u1eb7p m\u1ed9t redirect request. H\xe0m \u0111\u01b0\u1ee3c g\u1ecdi tr\u01b0\u1edbc khi th\u1ef1c hi\u1ec7n request k\u1ebf ti\u1ebfp.\r\nH\xe0m n\xe0y c\xf3 2 tham s\u1ed1 l\xe0 ",(0,r.jsx)(e.code,{children:"req"})," v\xe0 ",(0,r.jsx)(e.code,{children:"via"}),". ",(0,r.jsx)(e.code,{children:"req"})," th\u1ec3 hi\u1ec7n cho request ti\u1ebfp theo s\u1ebd \u0111\u01b0\u1ee3c g\u1ecdi. ",(0,r.jsx)(e.code,{children:"via"})," l\u01b0u l\u1ea1i\r\nc\xe1c request tr\u01b0\u1edbc \u0111\xe3 chuy\u1ec3n h\u01b0\u1edbng. Ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng h\xe0m n\xe0y \u0111\u1ec3 ki\u1ec3m so\xe1t s\u1ed1 l\u1ea7n chuy\u1ec3n h\u01b0\u1edbng c\u1ee7a request."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:'client := *http.DefaultClient\r\nclient.CheckRedirect = func(req *http.Request, via []*http.Request) error {\r\n    if len(via) >= 5 {\r\n        return fmt.Errorf("too many redirects")\r\n    }\r\n    if len(via) == 0 {\r\n        return nil\r\n    }\r\n    for attr, val := range via[0].Header {\r\n        if _, ok := req.Header[attr]; !ok {\r\n            req.Header[attr] = val\r\n        }\r\n    }\r\n    return nil\r\n}\n'})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Jar"})," d\xf9ng \u0111\u1ec3 t\u1ea1o Cookie cho request."]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:[(0,r.jsx)(e.strong,{children:"Timeout"})," c\u1ea5u h\xecnh gi\u1edbi h\u1ea1n th\u1eddi gian cho m\u1ed7i request. Th\u1eddi gian n\xe0y bao g\u1ed3m c\u1ea3 th\u1eddi gian chuy\u1ec3n h\u01b0\u1edbng v\xe0 \u0111\u1ecdc\r\nresponse body. C\u1ea5u h\xecnh m\u1eb7c \u0111\u1ecbnh l\xe0 ",(0,r.jsx)(e.code,{children:"no timeout"}),". Gi\u1ea3 s\u1eed nh\u01b0 request t\u1edbi server b\u1ecb r\u1edbt th\xec khi \u0111\xf3 request n\xe0y s\u1ebd\r\nkh\xf4ng \u0111\xf3ng l\u1ea1i v\xe0 connection v\u1eabn m\u1edf, v\xe0 n\u1ebfu c\xe1c request c\u1ee9 g\u1ecdi t\u1edbi server th\xec connection b\u1ecb treo s\u1ebd t\u0103ng l\xean. V\xec v\u1eady\r\nta n\xean \u0111\u1eb7t m\u1ed9t th\u1eddi gian timeout cho request khi t\u1ea1o m\u1ed9t http client ph\xf9 h\u1ee3p v\u1edbi ng\u1eef c\u1ea3nh s\u1eed d\u1ee5ng. V\xed d\u1ee5:"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"var httpClient = &http.Client{\r\n    Timeout: time.Second * 5,\r\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"default-transport",children:"Default Transport"}),"\n",(0,r.jsxs)(e.p,{children:["Struct ",(0,r.jsx)(e.code,{children:"Transport"})," d\xf9ng \u0111\u1ec3 qu\u1ea3n l\xfd c\xe1c connection v\xe0 idle connection v\xe0 th\u1ef1c hi\u1ec7n vi\u1ec7c g\u1ecdi request t\u1edbi server. C\xf9ng xem qua m\xf4 t\u1ea3 v\u1ec1 struct ",(0,r.jsx)(e.code,{children:"Transport"})," v\xe0 bi\u1ebfn ",(0,r.jsx)(e.code,{children:"DefaultTransport"}),"."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"// DefaultTransport is the default implementation of Transport and is\r\n// used by DefaultClient. It establishes network connections as needed\r\n// and caches them for reuse by subsequent calls. It uses HTTP proxies\r\n// as directed by the $HTTP_PROXY and $NO_PROXY (or $http_proxy and\r\n// $no_proxy) environment variables.\r\nvar DefaultTransport RoundTripper = &Transport{\r\n    Proxy: ProxyFromEnvironment,\r\n    DialContext: defaultTransportDialContext(&net.Dialer{\r\n        Timeout:   30 * time.Second,\r\n        KeepAlive: 30 * time.Second,\r\n    }),\r\n    ForceAttemptHTTP2:     true,\r\n    MaxIdleConns:          100,\r\n    IdleConnTimeout:       90 * time.Second,\r\n    TLSHandshakeTimeout:   10 * time.Second,\r\n    ExpectContinueTimeout: 1 * time.Second,\r\n}\r\n\r\n// DefaultMaxIdleConnsPerHost is the default value of Transport's\r\n// MaxIdleConnsPerHost.\r\nconst DefaultMaxIdleConnsPerHost = 2\r\n\r\ntype Transport struct {\r\n    ...\r\n\r\n    Proxy func(*Request) (*url.URL, error)\r\n\r\n    // MaxIdleConns controls the maximum number of idle (keep-alive)\r\n    // connections across all hosts. Zero means no limit.\r\n    MaxIdleConns int\r\n\r\n    // MaxIdleConnsPerHost, if non-zero, controls the maximum idle\r\n    // (keep-alive) connections to keep per-host. If zero,\r\n    // DefaultMaxIdleConnsPerHost is used.\r\n    MaxIdleConnsPerHost int\r\n\r\n    // MaxConnsPerHost optionally limits the total number of\r\n    // connections per host, including connections in the dialing,\r\n    // active, and idle states. On limit violation, dials will block.\r\n    //\r\n    // Zero means no limit.\r\n    MaxConnsPerHost int\r\n\r\n    // IdleConnTimeout is the maximum amount of time an idle\r\n    // (keep-alive) connection will remain idle before closing\r\n    // itself.\r\n    // Zero means no limit.\r\n    IdleConnTimeout time.Duration\r\n    ...\r\n}\n"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"Proxy"})," tr\u01b0\u1eddng h\u1ee3p request ta c\u1ea7n \u0111i qua proxy ta c\xf3 th\u1ec3 c\u1ea5u h\xecnh ch\u1ed7 n\xe0y. V\u1edbi ",(0,r.jsx)(e.code,{children:"DefaultTransport"})," c\xf3 khai b\xe1o\r\ns\u1eb5n m\u1ed9t function proxy \u0111\xf3 l\xe0 ",(0,r.jsx)(e.code,{children:"http.ProxyFromEnvironment"})," \u0111\u1ecdc proxy url t\u1eeb c\xe1c bi\u1ebfn m\xf4i tr\u01b0\u1eddng l\xe0 ",(0,r.jsx)(e.code,{children:"HTTP_PROXY"})," v\xe0\r\n",(0,r.jsx)(e.code,{children:"HTTP_PROXYS"}),". V\xec v\u1eady khi d\xf9ng function n\xe0y ta c\xf3 th\u1ec3 d\u1ec5 d\xe0ng b\u1eadt c\u1ea5u h\xecnh proxy cho client b\u1eb1ng c\xe1ch c\u1ea5u h\xecnh bi\u1ebfn\r\nm\xf4i tr\u01b0\u1eddng cho \u1ee9ng d\u1ee5ng."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"MaxIdleConns"})," l\xe0 s\u1ed1 l\u01b0\u1ee3ng idle connection t\u1ed1i \u0111a c\xf3 th\u1ec3 m\u1edf \u0111\u01b0\u1ee3c cho ",(0,r.jsx)(e.strong,{children:"t\u1ea5t c\u1ea3 host"}),"."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"MaxIdleConnsPerHost"})," s\u1ed1 l\u01b0\u1ee3ng idle connection t\u1ed1i \u0111a c\xf3 th\u1ec3 m\u1edf \u0111\u01b0\u1ee3c cho ",(0,r.jsx)(e.strong,{children:"m\u1ed7i host"})," v\xe0 gi\xe1 tr\u1ecb m\u1eb7c \u0111\u1ecbnh\r\n",(0,r.jsx)(e.code,{children:"DefaultMaxIdleConnsPerHost"})," l\xe0 2, \u0111\xe2y ch\xednh l\xe0 v\u1ea5n \u0111\u1ec1. Gi\u1ea3 s\u1eed c\xf3 100 connection trong connection pool th\xec ch\u1ec9 c\xf3 2\r\nconnection l\xe0 \u0111\u01b0\u1ee3c c\u1ea5p ph\xe1t cho 1 host. Khi c\xf3 nhi\u1ec1u request g\u1ecdi v\xe0o nh\u01b0ng th\u1ef1c t\u1ebf ch\u1ec9 c\xf3 2 request \u0111\u01b0\u1ee3c x\u1eed l\xfd,\r\nnh\u1eefng request c\xf2n l\u1ea1i \u0111\u01b0\u1ee3c chuy\u1ec3n v\u1ec1 tr\u1ea1ng th\xe1i ",(0,r.jsx)(e.code,{children:"TIME_WAIT"}),". \u0110\u1ec3 tr\xe1nh vi\u1ec7c b\u1ecb bottle neck n\xe0y th\xec ta n\xean c\xe2n nh\u1eafc\r\nt\u0103ng s\u1ed1 l\u01b0\u01a1ng ",(0,r.jsx)(e.code,{children:"MaxIdleConnsPerHost"})," n\xe0y l\xean."]}),"\n",(0,r.jsxs)(e.li,{children:[(0,r.jsx)(e.strong,{children:"IdleConnTimeout"})," th\u1eddi gian \u0111\xf3ng connection khi n\xf3 kh\xf4ng c\xf2n \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng. Th\u01b0 vi\u1ec7n http c\xf3 c\u01a1 ch\u1ebf thu th\u1eadp v\xe0\r\ns\u1eed d\u1ee5ng l\u1ea1i c\xe1c connection. Khi m\u1ed9t request \u0111\u01b0\u1ee3c th\u1ef1c hi\u1ec7n xong, connection \u0111\xf3 \u0111\u01b0\u1ee3c \u0111\u01b0a l\u1ea1i v\xe0o connection pool v\xe0\r\n\u0111\u01b0\u1ee3c t\xe1i s\u1eed d\u1ee5ng. N\u1ebfu nh\u01b0 c\xe1c request th\u1ef1c hi\u1ec7n xong v\xe0 kh\xf4ng c\xf2n request n\xe0o th\u1ef1c hi\u1ec7n n\u1eefa v\xe0 ta kh\xf4ng c\u1ea5u h\xecnh\r\n",(0,r.jsx)(e.code,{children:"IdleConnTimeout"})," th\xec connection \u0111\xf3 v\u1eabn s\u1ebd \u0111\u01b0\u1ee3c gi\u1eef k\u1ebft n\u1ed1i m\xe3i m\xe3i. Vi\u1ec7c n\xe0y s\u1ebd kh\xe1 t\u1ed1n t\xe0i nguy\xean b\u0103ng th\xf4ng n\u1ebfu\r\n\u1ee9ng d\u1ee5ng ch\xfang ta ch\u1ec9 th\u1ef1c hi\u1ec7n m\u1ed9t s\u1ed1 l\u01b0\u1ee3ng l\u1edbn request trong m\u1ed9t th\u1eddi gian ng\u1eafn v\xe0 sau \u0111\xf3 kh\xf4ng th\u1ef1c hi\u1ec7n request\r\nn\xe0o n\u1eefa. V\xec v\u1eady c\u1ea7n c\xe2n nh\u1eafc v\xe0 c\u1ea5u h\xecnh cho tr\u01b0\u1eddng n\xe0y."]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["V\xed d\u1ee5 ta c\xf3 th\u1ec3 t\u1eadn d\u1ee5ng l\u1ea1i ",(0,r.jsx)(e.code,{children:"DefaultTransport"})," b\u1eb1ng ph\u01b0\u01a1ng th\u1ee9c ",(0,r.jsx)(e.code,{children:"Clone()"})," \u0111\u1ec3 copy ra m\u1ed9t bi\u1ebfn Transport v\xe0 t\xf9y\r\nch\u1ec9nh c\xe1c c\u1ea5u h\xecnh theo \xfd mu\u1ed1n."]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-go",children:"t := http.DefaultTransport.(*http.Transport).Clone()\r\nt.MaxIdleConns = 100\r\nt.MaxConnsPerHost = 100\r\nt.MaxIdleConnsPerHost = 100\r\nt.IdleConnTimeout = 5 * time.Minute\r\n\r\nhttpClient = &http.Client{\r\n  Timeout:   10 * time.Second,\r\n  Transport: t,\r\n}\n"})}),"\n",(0,r.jsx)(e.h2,{id:"references",children:"References"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://www.loginradius.com/blog/engineering/tune-the-go-http-client-for-high-performance/",children:"How to Use the HTTP Client in Go To Enhance Performance"})}),"\n",(0,r.jsx)(e.li,{children:(0,r.jsx)(e.a,{href:"https://developpaper.com/golang-connection-pool-you-must-understand/",children:"Golang connection pool you must understand"})}),"\n"]})]})}function d(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(a,{...n})}):a(n)}},1151:(n,e,t)=>{t.d(e,{Z:()=>s,a:()=>c});var r=t(7294);const i={},o=r.createContext(i);function c(n){const e=r.useContext(o);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function s(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),r.createElement(o.Provider,{value:e},n.children)}}}]);